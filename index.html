<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Himalaya Cat: Eternal Dream</title>
    <style>
        :root { --gold: #FFD700; --neon-blue: #00f2ff; --neon-pink: #ff00ea; --red: #ff3131; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ */
        #ui-layer { position: fixed; top: 0; width: 100%; padding: 20px; z-index: 1000; pointer-events: none; }
        #progress-container { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,215,0,0.3); }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--neon-blue), var(--gold)); box-shadow: 0 0 15px var(--gold); transition: 0.3s; }
        
        #stats-bar { display: flex; justify-content: space-between; margin-top: 10px; color: #fff; font-weight: bold; font-size: 16px; text-shadow: 0 0 10px #000; }
        .stat-item { background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); transition: 0.5s; }
        .panel { background: linear-gradient(145deg, #0a0a20, #000); padding: 30px; border-radius: 40px; border: 2px solid var(--gold); text-align: center; width: 90%; max-width: 500px; box-shadow: 0 0 50px rgba(255,215,0,0.2); }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; max-height: 180px; overflow-y: auto; padding: 10px; }
        .node { background: #111; padding: 12px; border-radius: 15px; border: 1px solid #333; cursor: pointer; color: #444; transition: 0.3s; font-size: 11px; }
        .node.unlocked { color: #fff; border-color: #555; }
        .node.active { background: var(--gold); color: #000; box-shadow: 0 0 20px var(--gold); transform: scale(1.1); }
        .node.locked::after { content: 'ğŸ”’'; display: block; font-size: 10px; }

        .btn-play { background: var(--gold); color: #000; width: 100%; padding: 15px; border-radius: 50px; border: none; font-size: 22px; font-weight: bold; cursor: pointer; margin-top: 20px; box-shadow: 0 0 20px rgba(255,215,0,0.4); }
        .btn-play:active { transform: scale(0.95); }

        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="progress-container"><div id="progress-bar"></div></div>
    <div id="stats-bar">
        <div class="stat-item">ğŸ’° <span id="c-count">0</span></div>
        <div class="stat-item">ğŸ“ Ù…ØªØ¬Ø± <span id="s-count">1</span></div>
        <div class="stat-item" style="border-color:var(--neon-blue)">â¤ï¸ <span id="h-count">100</span></div>
    </div>
</div>

<div id="overlay">
    <div class="panel">
        <h1 id="title" style="color:var(--gold); margin:0;">Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§</h1>
        <div class="grid" id="grid"></div>
        <div style="padding: 15px; border: 1px dashed var(--red); border-radius: 20px;">
            <p style="color:#eee; font-size:12px; margin:0;">Ø¯Ø¹Ù… Ù…Ù„Ø§Ø¬Ø¦ Ø§Ù„Ù‚Ø·Ø· ($1)</p>
            <button onclick="sfx(200,'sine',0.2)" style="background:var(--red); border:none; color:white; padding:5px 15px; border-radius:10px; margin-top:5px; cursor:pointer;">ØªØ¨Ø±Ø¹</button>
        </div>
        <button class="btn-play" onclick="initGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒÙ‡Ù ğŸš€</button>
    </div>
</div>

<script>
const canvas = document.createElement('canvas'), ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

// Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ©
const imgs = {
    cat: new Image(), coin: new Image(), monster: new Image(), gem: new Image()
};
imgs.cat.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png';
imgs.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';
imgs.monster.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png';
imgs.gem.src = 'https://cdn-icons-png.flaticon.com/512/616/616430.png';

let state = { playing: false, stage: 1, unlocked: 1, score: 0, health: 100, dist: 0, frame: 0, portal: -1 };
let entities = { obs: [], gold: [], gems: [], fx: [] };
let cat = { x: 0, y: 0, v: 0, g: 0.48, j: -9.5, w: 75, h: 65 };

const audio = new (window.AudioContext || window.webkitAudioContext)();
function sfx(f, t, d) {
    if(audio.state === 'suspended') audio.resume();
    let o = audio.createOscillator(), g = audio.createGain();
    o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + d);
    o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
}

function resize() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    cat.x = canvas.width * 0.15;
}
window.onresize = resize; resize();

function drawMenu() {
    const grid = document.getElementById('grid'); grid.innerHTML = '';
    for(let i=1; i<=20; i++) {
        const d = document.createElement('div');
        let status = i <= state.unlocked ? 'unlocked' : 'locked';
        d.className = `node ${status} ${i==state.stage?'active':''}`;
        d.innerHTML = `Ù…Ø±Ø­Ù„Ø© ${i}`;
        if(status === 'unlocked') d.onclick = () => { state.stage = i; drawMenu(); sfx(400,'sine',0.1); };
        grid.appendChild(d);
    }
}
drawMenu();

function initGame() {
    state.playing = true; state.dist = 0; state.health = 100; state.portal = -1;
    entities = { obs: [], gold: [], gems: [], fx: [] };
    cat.y = canvas.height/2; cat.v = 0;
    document.getElementById('overlay').style.opacity = '0';
    setTimeout(() => document.getElementById('overlay').style.display = 'none', 500);
    sfx(150, 'square', 0.5);
    render();
}

function spawnFX(x, y, color) {
    for(let i=0; i<10; i++) entities.fx.push({x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, a: 1, c: color});
}

function render() {
    if(!state.playing) return;
    state.frame++;
    if(state.portal === -1) state.dist += 2;

    let target = 3000;
    let prog = Math.min(100, (state.dist / target) * 100);
    document.getElementById('progress-bar').style.width = prog + '%';
    document.getElementById('c-count').innerText = state.score;
    document.getElementById('s-count').innerText = state.stage;
    document.getElementById('h-count').innerText = state.health;

    // Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
    let grd = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    grd.addColorStop(0, '#050510'); grd.addColorStop(1, `hsla(${state.frame % 360}, 30%, 10%, 1)`);
    ctx.fillStyle = grd; ctx.fillRect(0,0,canvas.width, canvas.height);

    // Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² Ø§Ù„Ù…ØªÙ…ÙˆØ¬ (Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø©)
    let wallH = (canvas.height * 0.18);
    ctx.fillStyle = `hsla(${state.stage * 40}, 70%, 15%, 0.9)`;
    for(let i=0; i<canvas.width; i+=4) {
        let wave = Math.sin((i + state.frame * 5) * 0.01) * 25;
        ctx.fillRect(i, 0, 5, wallH + wave);
        ctx.fillRect(i, canvas.height - (wallH + wave), 5, wallH + wave);
    }

    // Ø§Ù„Ù‚Ø·Ø© Ù…Ø¹ ÙˆÙ‡Ø¬
    cat.v += cat.g; cat.y += cat.v;
    ctx.save();
    ctx.translate(cat.x + cat.w/2, cat.y + cat.h/2);
    ctx.rotate(cat.v * 0.04);
    ctx.shadowBlur = 20; ctx.shadowColor = varColor();
    ctx.drawImage(imgs.cat, -cat.w/2, -cat.h/2, cat.w, cat.h);
    ctx.restore();

    // Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
    entities.fx.forEach((f, i) => {
        f.x += f.vx; f.y += f.vy; f.a -= 0.02;
        ctx.fillStyle = `rgba(${f.c}, ${f.a})`;
        ctx.fillRect(f.x, f.y, 4, 4);
        if(f.a <= 0) entities.fx.splice(i, 1);
    });

    // Ø§Ù„Ø°Ù‡Ø¨ (Ø¨Ø¯Ù„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±)
    if(state.frame % 80 == 0 && state.portal === -1) entities.gold.push({x: canvas.width, y: wallH + 100 + Math.random()*(canvas.height - wallH*2 - 200)});
    entities.gold.forEach((g, i) => {
        g.x -= 6; ctx.drawImage(imgs.coin, g.x, g.y, 35, 35);
        if(Math.hypot(cat.x+35-g.x, cat.y+30-g.y) < 40) {
            spawnFX(g.x, g.y, "255, 215, 0");
            entities.gold.splice(i,1); state.score += 10; sfx(800, 'sine', 0.1);
        }
    });

    // Ø§Ù„ÙˆØ­ÙˆØ´
    if(state.frame > 100 && state.frame % Math.max(25, 90 - state.stage*4) == 0 && state.portal === -1) {
        entities.obs.push({x: canvas.width, y: wallH + 50 + Math.random()*(canvas.height - wallH*2 - 100), s: 70});
    }
    entities.obs.forEach((o, i) => {
        o.x -= (7 + state.stage*0.5); 
        ctx.drawImage(imgs.monster, o.x, o.y, o.s, o.s);
        if(cat.x+20 < o.x+o.s-20 && cat.x+cat.w-20 > o.x+20 && cat.y+20 < o.y+o.s-20 && cat.y+cat.h-20 > o.y+20) {
            state.health -= 20; spawnFX(cat.x, cat.y, "255, 0, 0");
            entities.obs.splice(i, 1); sfx(100, 'sawtooth', 0.3);
            if(state.health <= 0) gameOver(false);
        }
    });

    // Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙƒÙ‡Ù Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ©
    if(prog >= 100 && state.portal === -1) state.portal = canvas.width;
    if(state.portal > -1) {
        state.portal -= 6;
        ctx.fillStyle = '#000';
        ctx.beginPath(); ctx.ellipse(state.portal, canvas.height/2, 100, 250, 0, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = varColor(); ctx.lineWidth = 10; ctx.stroke();
        if(cat.x > state.portal - 50) gameOver(true);
    }

    if(cat.y < wallH - 10 || cat.y > canvas.height - wallH - cat.h + 10) gameOver(false);
    
    requestAnimationFrame(render);
}

function varColor() { return state.stage === 20 ? 'var(--neon-pink)' : 'var(--gold)'; }

function gameOver(win) {
    state.playing = false;
    sfx(win ? 1000 : 80, win ? 'square' : 'sawtooth', 0.5);
    const title = document.getElementById('title');
    if(win) {
        if(state.stage === state.unlocked) state.unlocked++;
        title.innerText = state.stage === 20 ? "ğŸ‰ Ø­Ù„Ù… Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§ ØªØ­Ù‚Ù‚!" : "âœ… ØªÙ… Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„ÙƒÙ‡Ù!";
    } else {
        title.innerText = "ğŸ’€ Ø³Ù‚Ø·Øª Ø§Ù„Ù‚Ø·Ø©!";
    }
    drawMenu();
    document.getElementById('overlay').style.display = 'flex';
    setTimeout(() => document.getElementById('overlay').style.opacity = '1', 10);
}

const jump = (e) => { if(state.playing) { cat.v = cat.j; sfx(600, 'triangle', 0.08); } if(e) e.preventDefault(); };
window.onmousedown = jump; window.ontouchstart = jump;
</script>
</body>
</html>