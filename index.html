<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: Cat's Revenge</title>
    <style>
        :root { --gold: #FFD700; --blood: #ff3131; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© HUD */
        #hud { position: fixed; top: 15px; width: 100%; padding: 0 20px; z-index: 1000; display: flex; justify-content: space-between; color: white; font-weight: bold; }
        .stat-item { background: rgba(0,0,0,0.8); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--gold); }

        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; text-align: center; color: white; }
        .menu { background: #111; border: 3px solid var(--gold); padding: 30px; border-radius: 25px; width: 85%; max-width: 400px; }
        .btn-start { background: var(--gold); color: #000; border: none; padding: 15px 40px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 20px; }

        canvas { display: block; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat-item">ğŸ’° <span id="coins">0</span></div>
    <div class="stat-item">â¤ï¸ <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="overlay">
    <div class="menu">
        <h1 style="color:var(--gold);">Ù‡Ø¬ÙˆÙ… Ø§Ù„ÙˆØ­ÙˆØ´ ğŸ¾</h1>
        <p>Ø§Ø¯ÙØ¹ 10 ÙƒÙˆÙŠÙ†Ø² Ù„Ù„Ø¯Ø®ÙˆÙ„<br>ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø°Ù‡Ø¨ Ù„ØªØµØ¨Ø­ Ù…Ù„Ùƒ Ø§Ù„Ù‚ØµØ±!</p>
        <button class="btn-start" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ğŸš€</button>
    </div>
</div>

<script>
const cvs = document.createElement('canvas');
const ctx = cvs.getContext('2d');
document.body.appendChild(cvs);

// Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„ØµÙˆØ±)
const imgs = {
    cat: new Image(),
    monster: new Image(),
    coin: new Image()
};
imgs.cat.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png'; // Ù‚Ø·Ø©
imgs.monster.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png'; // ÙˆØ­Ø´ Ù…Ø±Ø¹Ø¨
imgs.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png'; // ÙƒÙˆÙŠÙ† Ø°Ù‡Ø¨ÙŠ

// Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª (Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø§Ø±ÙŠÙˆ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playMarioJump() {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
}

function playMarioCoin() {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(987.77, audioCtx.currentTime); // B5
    osc.frequency.setValueAtTime(1318.51, audioCtx.currentTime + 0.1); // E6
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.3);
}

// Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
let state = { playing: false, score: 0, lives: 3, dist: 0 };
let player = { x: 50, y: 200, v: 0, g: 0.5, j: -10, w: 70, h: 70 };
let enemies = [], coins = [];

function resize() {
    cvs.width = window.innerWidth; cvs.height = window.innerHeight;
    player.x = cvs.width * 0.15;
}
window.onresize = resize; resize();

function startGame() {
    state = { playing: true, score: 0, lives: 3, dist: 0 };
    enemies = []; coins = [];
    player.y = cvs.height / 2;
    document.getElementById('overlay').style.display = 'none';
    audioCtx.resume(); // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª
    loop();
}

function loop() {
    if(!state.playing) return;
    
    // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø© (Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚ØµØ±)
    ctx.fillStyle = '#0a0510'; ctx.fillRect(0,0,cvs.width, cvs.height);
    
    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù‚Ø·Ø©
    player.v += player.g; player.y += player.v;
    if(player.y > cvs.height - player.h) player.y = cvs.height - player.h;
    if(player.y < 0) player.y = 0;
    
    ctx.drawImage(imgs.cat, player.x, player.y, player.w, player.h);

    // Ø§Ù„ÙˆØ­ÙˆØ´ (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¯Ø±Ø§Ø¬Ø§Øª)
    if(Math.random() < 0.02) {
        enemies.push({ x: cvs.width, y: Math.random()*(cvs.height-80), s: 80 });
    }
    enemies.forEach((en, i) => {
        en.x -= 6;
        ctx.drawImage(imgs.monster, en.x, en.y, en.s, en.s);
        // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„ÙˆØ­Ø´
        if(player.x < en.x + en.s - 20 && player.x + player.w > en.x + 20 &&
           player.y < en.y + en.s - 20 && player.y + player.h > en.y + 20) {
            state.lives--;
            enemies.splice(i, 1);
            if(state.lives <= 0) gameOver();
        }
    });

    // Ø§Ù„ÙƒÙˆÙŠÙ†Ø² (ØµÙˆØª Ù…Ø§Ø±ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…Ø¹)
    if(Math.random() < 0.03) {
        coins.push({ x: cvs.width, y: Math.random()*(cvs.height-40), s: 40 });
    }
    coins.forEach((c, i) => {
        c.x -= 5;
        ctx.drawImage(imgs.coin, c.x, c.y, c.s, c.s);
        if(Math.hypot(player.x+35 - c.x, player.y+35 - c.y) < 40) {
            state.score += 10;
            playMarioCoin(); // ØµÙˆØª Ø§Ù„ÙƒÙˆÙŠÙ†!
            coins.splice(i, 1);
            document.getElementById('coins').innerText = state.score;
        }
    });

    document.getElementById('lives').innerText = "â¤ï¸".repeat(state.lives);
    requestAnimationFrame(loop);
}

function gameOver() {
    state.playing = false;
    document.getElementById('overlay').style.display = 'flex';
    document.querySelector('h1').innerText = "Ø§Ù„ØªÙ‡Ù…ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´! ğŸ’€";
}

// Ø§Ù„Ù‚ÙØ² Ø¨ØµÙˆØª Ù…Ø§Ø±ÙŠÙˆ
const jump = () => { 
    if(state.playing) { 
        player.v = player.j; 
        playMarioJump(); // ØµÙˆØª Ø§Ù„Ù‚ÙØ²Ø©!
    } 
};
window.onmousedown = jump;
window.ontouchstart = (e) => { e.preventDefault(); jump(); };

</script>
</body>
</html>