<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: 20 Stages of Terror</title>
    <style>
        :root { --gold: #FFD700; --blood: #ff0000; }
        * { box-sizing: border-box; touch-action: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ HUD */
        #hud { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 1000; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.8); border: 2px solid var(--gold); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; min-width: 80px; text-align: center; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .card { background: #111; border: 3px solid var(--gold); border-radius: 30px; padding: 40px; text-align: center; color: white; width: 85%; max-width: 450px; box-shadow: 0 0 50px rgba(255,215,0,0.2); }
        .btn { background: var(--gold); color: black; border: none; padding: 15px 40px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 20px; }
        
        canvas { display: block; filter: contrast(1.1) brightness(0.9); }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat">ğŸ’° <span id="coin-val">0</span></div>
    <div class="stat">ğŸ° Ù…Ø±Ø­Ù„Ø©: <span id="stage-val">1</span></div>
    <div class="stat">â¤ï¸ <span id="life-val">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="overlay">
    <div class="card">
        <h1 id="m-title" style="color:var(--gold); margin:0;">Ù‚ØµØ± Ø§Ù„ÙˆØ­ÙˆØ´ Ø§Ù„Ø¹Ø´Ø±ÙŠÙ†</h1>
        <p id="m-desc">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ø¯ÙØ¹ 10 ÙƒÙˆÙŠÙ†Ø² Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©.</p>
        <button class="btn" onclick="startStage()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ¾</button>
    </div>
</div>

<script>
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

// --- 1. Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„ØµÙˆØ±) ---
const img = {
    cat: new Image(), coin: new Image(),
    monsters: [new Image(), new Image(), new Image(), new Image()]
};
img.cat.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png'; 
img.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';
img.monsters[0].src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png'; // ØºÙˆÙ„ (1-5)
img.monsters[1].src = 'https://cdn-icons-png.flaticon.com/512/606/606795.png';  // Ø®ÙØ§Ø´ (6-10)
img.monsters[2].src = 'https://cdn-icons-png.flaticon.com/512/1068/1068132.png'; // Ø´Ø¨Ø­ (11-15)
img.monsters[3].src = 'https://cdn-icons-png.flaticon.com/512/4334/4334000.png'; // Ø´ÙŠØ·Ø§Ù† (16-20)

// --- 2. Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª (Mario Style) ---
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSFX(type) {
    if (audio.state === 'suspended') audio.resume();
    const osc = audio.createOscillator();
    const g = audio.createGain();
    osc.connect(g); g.connect(audio.destination);
    
    if(type === 'jump') { 
        osc.frequency.setValueAtTime(150, audio.currentTime);
        osc.frequency.exponentialRampToValueAtTime(600, audio.currentTime + 0.1);
        g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.1);
        osc.start(); osc.stop(audio.currentTime + 0.1);
    } else if(type === 'coin') {
        osc.frequency.setValueAtTime(987, audio.currentTime);
        osc.frequency.setValueAtTime(1318, audio.currentTime + 0.08);
        g.gain.setValueAtTime(0.1, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.3);
        osc.start(); osc.stop(audio.currentTime + 0.3);
    }
}

// --- 3. Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
let state = { playing: false, stage: 1, score: 0, coins: 50, lives: 3, dist: 0, target: 3000 };
let player = { x: 50, y: 0, v: 0, g: 0.45, j: -9, w: 70, h: 70 };
let enemies = [], goldList = [];

function resize() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    player.x = canvas.width * 0.15;
}
window.onresize = resize; resize();

function startStage() {
    if(state.coins < 10) { alert("ØªØ­ØªØ§Ø¬ 10 ÙƒÙˆÙŠÙ†Ø²!"); return; }
    state.coins -= 10;
    state.playing = true; state.dist = 0; state.lives = 3;
    state.target = 2000 + (state.stage * 1000); // ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ø£Ø·ÙˆÙ„
    enemies = []; goldList = [];
    player.y = canvas.height / 2;
    document.getElementById('overlay').style.display = 'none';
    updateHUD();
    loop();
}

function loop() {
    if(!state.playing) return;
    
    // Ø®Ù„ÙÙŠØ© Ù…ØªØºÙŠØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹ÙˆØ§Ù„Ù… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©
    let worldIdx = Math.min(3, Math.floor((state.stage - 1) / 5));
    const bgs = ['#0a0505', '#050a05', '#05050a', '#0a000a'];
    ctx.fillStyle = bgs[worldIdx]; ctx.fillRect(0,0,canvas.width, canvas.height);
    
    // Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ© ÙˆØ§Ù„Ø­Ø±ÙƒØ©
    player.v += player.g; player.y += player.v;
    if(player.y > canvas.height - player.h) player.y = canvas.height - player.h;
    if(player.y < 0) player.y = 0;
    ctx.drawImage(img.cat, player.x, player.y, player.w, player.h);

    state.dist += (5 + state.stage);

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙˆØ­ÙˆØ´
    if(Math.random() < 0.02 + (state.stage * 0.002)) {
        enemies.push({ x: canvas.width, y: Math.random()*(canvas.height-80), s: 80 + (state.stage*2) });
    }
    enemies.forEach((en, i) => {
        en.x -= (7 + state.stage);
        // Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ­ÙˆØ´ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 10
        if(state.stage > 10 && en.x < canvas.width/2) {
            en.y += (player.y > en.y) ? 1 : -1;
        }
        ctx.drawImage(img.monsters[worldIdx], en.x, en.y, en.s, en.s);
        
        // ØªØµØ§Ø¯Ù…
        if(player.x < en.x+en.s-20 && player.x+player.w > en.x+20 && player.y < en.y+en.s-20 && player.y+player.h > en.y+20) {
            state.lives--; enemies.splice(i, 1);
            if(state.lives <= 0) gameOver(false);
            updateHUD();
        }
    });

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆÙŠÙ†Ø²
    if(Math.random() < 0.03) goldList.push({ x: canvas.width, y: Math.random()*(canvas.height-40) });
    goldList.forEach((c, i) => {
        c.x -= 6;
        ctx.drawImage(img.coin, c.x, c.y, 40, 40);
        if(Math.hypot(player.x+35-c.x, player.y+35-c.y) < 45) {
            state.coins += 5; playSFX('coin'); goldList.splice(i, 1); updateHUD();
        }
    });

    // ÙØ­Øµ Ø§Ù„ÙÙˆØ² Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    if(state.dist >= state.target) gameOver(true);
    else requestAnimationFrame(loop);
}

function updateHUD() {
    document.getElementById('coin-val').innerText = state.coins;
    document.getElementById('stage-val').innerText = state.stage;
    document.getElementById('life-val').innerText = "â¤ï¸".repeat(state.lives);
}

function gameOver(win) {
    state.playing = false;
    document.getElementById('overlay').style.display = 'flex';
    const title = document.getElementById('m-title');
    const desc = document.getElementById('m-desc');
    
    if(win) {
        title.innerText = `ØªÙ… ØºØ²Ùˆ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${state.stage}! ğŸ‰`;
        state.stage++;
        desc.innerText = `Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© ${state.stage}. Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ²Ø¯Ø§Ø¯ ÙˆØ§Ù„ÙˆØ­ÙˆØ´ ØªØªØºÙŠØ±!`;
    } else {
        title.innerText = "Ø³Ø­Ù‚ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´! ğŸ’€";
        desc.innerText = `Ø®Ø³Ø±Øª Ø±Ù‡Ø§Ù†Ùƒ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${state.stage}. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹!`;
    }
    if(state.stage > 20) {
        title.innerText = "Ø£Ù†Øª Ù…Ù„Ùƒ Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§! ğŸ‘‘";
        desc.innerText = "Ù„Ù‚Ø¯ Ù‡Ø²Ù…Øª Ø§Ù„Ù€ 20 Ù…Ø±Ø­Ù„Ø© ÙˆØ£ØµØ¨Ø­Øª Ø£Ø³Ø·ÙˆØ±Ø©.";
        state.stage = 1; // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ…Ù„Ùƒ
    }
}

// Ø§Ù„ØªØ­ÙƒÙ…
const jump = () => { if(state.playing) { player.v = player.j; playSFX('jump'); } };
window.onmousedown = jump;
window.ontouchstart = (e) => { e.preventDefault(); jump(); };
</script>
</body>
</html>