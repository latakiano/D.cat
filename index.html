<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: 20 Stages of Terror</title>
    <style>
        :root { --gold: #FFD700; --neon: #00f2ff; }
        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }
        body { background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© HUD */
        #hud { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 1000; }
        .badge { background: rgba(0,0,0,0.8); border: 2px solid var(--gold); color: #fff; padding: 10px 20px; border-radius: 50px; font-weight: bold; min-width: 100px; text-align: center; box-shadow: 0 0 15px rgba(255,215,0,0.3); }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„ØªÙˆÙ‚Ù ÙˆØ§Ù„ÙÙˆØ² */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; align-items: center; justify-content: center; text-align: center; }
        .panel { border: 3px solid var(--gold); padding: 40px; border-radius: 40px; color: white; background: #111; max-width: 450px; width: 90%; }
        .btn { background: var(--gold); color: #000; border: none; padding: 15px 50px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        .btn:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--gold); }
        
        #progress { position: fixed; bottom: 0; left: 0; height: 6px; background: var(--gold); width: 0%; transition: 0.1s; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="progress"></div>
<div id="hud">
    <div class="badge">ğŸ’° <span id="coin-val">520</span></div>
    <div class="badge">ğŸ° <span id="stage-name">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1</span></div>
    <div class="badge">â¤ï¸ <span id="life-val">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="overlay">
    <div class="panel">
        <h1 id="m-title" style="color:var(--gold); font-size: 32px; margin-bottom: 10px;">Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù‚Ø·Ø· ğŸ¾</h1>
        <p id="m-desc">Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù…ÙˆØ§Ø¬Ù‡Ø© ÙˆØ­ÙˆØ´ Ø§Ù„Ø³Ø±Ø¯Ø§Ø¨ØŸ <br> Ø§Ù„Ø±Ù‡Ø§Ù†: 10 ÙƒÙˆÙŠÙ†Ø² Ù„Ù„Ø¯Ø®ÙˆÙ„.</p>
        <button class="btn" onclick="startAdventure()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ğŸ”¥</button>
    </div>
</div>

<script>
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

// --- Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª (Ù…Ø§Ø±ÙŠÙˆ Ø³ØªØ§ÙŠÙ„) ---
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSound(f1, f2, d) {
    if(audio.state === 'suspended') audio.resume();
    const o = audio.createOscillator(); const g = audio.createGain();
    o.connect(g); g.connect(audio.destination);
    o.frequency.setValueAtTime(f1, audio.currentTime);
    o.frequency.exponentialRampToValueAtTime(f2, audio.currentTime + d);
    g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + d);
    o.start(); o.stop(audio.currentTime + d);
}

// --- Ø±Ø³Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ (Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¯Ù‚Ø©) ---
function drawCat(x, y, s, rage) {
    ctx.save();
    if(rage > 0) { ctx.shadowBlur = 25; ctx.shadowColor = "gold"; ctx.filter = "brightness(1.5)"; }
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.ellipse(x+s/2, y+s/2, s/2, s/3, 0, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(x+s*0.75, y+s/3, s/4, 0, Math.PI*2); ctx.fill(); // Ø±Ø£Ø³
    ctx.fillStyle = "#000"; ctx.fillRect(x+s*0.8, y+s/4, 4, 4); // Ø¹ÙŠÙ†
    ctx.restore();
}

function drawMonster(x, y, s, world) {
    const colors = ["#5500ff", "#00ff55", "#ff00ff", "#ff3300"];
    ctx.fillStyle = colors[world] || "#ff0000";
    ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
    ctx.beginPath();
    for(let i=0; i<8; i++) {
        let ang = (i/8) * Math.PI*2 + Date.now()*0.005;
        let r = s/2 + Math.sin(Date.now()*0.01)*5;
        ctx.lineTo(x+s/2 + Math.cos(ang)*r, y+s/2 + Math.sin(ang)*r);
    }
    ctx.fill();
    ctx.fillStyle = "#fff"; ctx.fillRect(x+s/4, y+s/3, 6, 6); ctx.fillRect(x+s*0.6, y+s/3, 6, 6);
}

// --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
let state = { playing: false, stage: 1, coins: 520, lives: 3, dist: 0, target: 3000, rage: 0 };
let player = { x: 0, y: 0, v: 0, g: 0.45, j: -9, s: 70 };
let entities = { monsters: [], coins: [] };
const worldNames = ["Ø³Ø±Ø¯Ø§Ø¨ Ø§Ù„ØºØ¨Ø§Ø±", "ØºØ§Ø¨Ø© Ø§Ù„Ø£Ø±ÙˆØ§Ø­", "Ù‚ØµØ± Ø§Ù„Ù…Ø±Ø§ÙŠØ§", "Ø¹Ø±Ø´ Ø§Ù„Ø¬Ø­ÙŠÙ…"];

function resize() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    player.x = canvas.width * 0.15;
}
window.onresize = resize; resize();

function startAdventure() {
    if(state.coins < 10) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ!");
    state.coins -= 10;
    state.playing = true; state.dist = 0; state.lives = 3; state.rage = 0;
    state.target = 3000 + (state.stage * 1000);
    entities = { monsters: [], coins: [] };
    player.y = canvas.height/2;
    document.getElementById('overlay').style.display = 'none';
    updateUI();
    gameLoop();
}

function gameLoop() {
    if(!state.playing) return;
    
    // Ø®Ù„ÙÙŠØ© Ù…ØªØºÙŠØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…
    let worldIdx = Math.min(3, Math.floor((state.stage-1)/5));
    ctx.fillStyle = `hsl(${worldIdx * 80}, 20%, 5%)`;
    ctx.fillRect(0,0,canvas.width, canvas.height);

    // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
    player.v += player.g; player.y += player.v;
    if(player.y > canvas.height - player.s) player.y = canvas.height - player.s;
    if(player.y < 0) { player.y = 0; player.v = 0; }
    
    drawCat(player.x, player.y, player.s, state.rage);
    if(state.rage > 0) state.rage--;

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙˆØ­ÙˆØ´ (Ø°ÙƒØ§Ø¡ Ù…ØªØ²Ø§ÙŠØ¯)
    if(Math.random() < 0.02 + (state.stage * 0.002)) {
        entities.monsters.push({ x: canvas.width, y: Math.random()*(canvas.height-80), s: 70+(state.stage*2), spd: 6+(state.stage*0.4) });
    }
    entities.monsters.forEach((m, i) => {
        m.x -= m.spd;
        // Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ­Ø´ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5
        if(state.stage > 5 && m.x < canvas.width * 0.6) {
            m.y += (player.y > m.y) ? 1.2 : -1.2;
        }
        drawMonster(m.x, m.y, m.s, worldIdx);
        
        // ØªØµØ§Ø¯Ù…
        if(Math.hypot(player.x+35 - (m.x+m.s/2), player.y+35 - (m.y+m.s/2)) < 55) {
            if(state.rage > 0) {
                entities.monsters.splice(i, 1);
                state.coins += 20; playSound(400, 200, 0.1);
            } else {
                state.lives--; entities.monsters.splice(i, 1);
                playSound(100, 10, 0.3);
                if(state.lives <= 0) endGame(false);
            }
            updateUI();
        }
    });

    // Ø§Ù„Ø°Ù‡Ø¨
    if(Math.random() < 0.03) entities.coins.push({ x: canvas.width, y: Math.random()*(canvas.height-40) });
    entities.coins.forEach((c, i) => {
        c.x -= 5;
        ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(c.x, c.y, 15, 0, Math.PI*2); ctx.fill();
        if(Math.hypot(player.x+35 - c.x, player.y+35 - c.y) < 45) {
            state.coins += 10; state.rage = 120; // ÙˆØ¶Ø¹ Ø§Ù„ØºØ¶Ø¨
            playSound(987, 1318, 0.2); entities.coins.splice(i, 1);
            updateUI();
        }
    });

    state.dist += (5 + state.stage*0.5);
    document.getElementById('progress').style.width = (state.dist / state.target * 100) + "%";

    if(state.dist >= state.target) endGame(true);
    else requestAnimationFrame(gameLoop);
}

function updateUI() {
    document.getElementById('coin-val').innerText = state.coins;
    document.getElementById('life-val').innerText = "â¤ï¸".repeat(state.lives);
    document.getElementById('stage-name').innerText = worldNames[Math.min(3, Math.floor((state.stage-1)/5))] + " - Ù…Ø±Ø­Ù„Ø© " + state.stage;
}

function endGame(win) {
    state.playing = false;
    document.getElementById('overlay').style.display = 'flex';
    const t = document.getElementById('m-title');
    const d = document.getElementById('m-desc');
    
    if(win) {
        t.innerText = `Ø§Ù„Ù†ØµØ± ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${state.stage}! ğŸ‰`;
        state.stage++;
        d.innerText = "Ù„Ù‚Ø¯ Ø£Ø«Ø¨ØªÙ‘ Ø¬Ø¯Ø§Ø±ØªÙƒ.. Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ";
        if(state.stage > 20) t.innerText = "Ø£Ù†Øª Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§! ğŸ‘‘";
    } else {
        t.innerText = "Ø³Ø­Ù‚ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´! ğŸ’€";
        d.innerText = "Ø®Ø³Ø±Øª Ø±Ù‡Ø§Ù†Ùƒ.. Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø´Ø±ÙÙƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.";
    }
}

window.onmousedown = () => { if(state.playing) { player.v = player.j; playSound(200, 600, 0.1); } };
window.ontouchstart = (e) => { e.preventDefault(); if(state.playing) { player.v = player.j; playSound(200, 600, 0.1); } };
</script>
</body>
</html>