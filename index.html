<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: Throne of Legends</title>
    <style>
        :root { --gold: #FFD700; --neon-blue: #00f2ff; --blood: #ff0000; --dark: #050505; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ø£Ø³ÙˆØ§Ù‚ */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); color: white; }
        .royal-card { background: linear-gradient(145deg, #111, #000); border: 2px solid var(--gold); border-radius: 30px; padding: 30px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 0 50px rgba(255,215,0,0.1); }
        
        .market-scroller { display: flex; gap: 15px; overflow-x: auto; padding: 15px 5px; scrollbar-width: none; }
        .cat-item { min-width: 120px; background: #1a1a1a; padding: 15px; border-radius: 20px; border: 1px solid #333; transition: 0.3s; }
        .cat-item.active { border-color: var(--gold); background: #222; transform: scale(1.05); }
        .cat-item img { width: 60px; height: 60px; margin-bottom: 10px; }
        
        .btn-play { background: var(--gold); color: #000; width: 100%; padding: 18px; border-radius: 50px; border: none; font-size: 24px; font-weight: bold; cursor: pointer; margin-top: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        /* HUD - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        #hud { position: fixed; top: 10px; width: 100%; padding: 10px 20px; z-index: 1000; display: flex; justify-content: space-between; color: white; font-weight: bold; text-shadow: 2px 2px 5px #000; }
        .stat { background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); }

        #flash { position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 2500; }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="flash"></div>

<div id="hud" style="display:none;">
    <div class="stat">ğŸ’° $<span id="balance">500</span></div>
    <div class="stat" style="border-color:red">â¤ï¸ <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
    <div class="stat">ğŸ† <span id="score">0</span></div>
</div>

<div id="overlay">
    <div class="royal-card">
        <h1 style="color:var(--gold); margin:0;">Ù‚Ø§Ø¹Ø© Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§</h1>
        <p style="color:#888;">Ø§Ø®ØªØ± Ù‚Ø·ØªÙƒ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ÙˆØ±Ø§Ù‡Ù† Ù„ØªØºØ²Ùˆ Ø§Ù„Ø¹Ø±Ø´</p>

        <div class="market-scroller">
            <div class="cat-item active" onclick="selectCat(this, 1, 0)">
                <img src="https://cdn-icons-png.flaticon.com/512/1864/1864514.png">
                <div>Ø§Ù„Ø¹Ø§Ø¯ÙŠ</div><small>3 Ø£Ø±ÙˆØ§Ø­ | Ù…Ø¬Ø§Ù†ÙŠ</small>
            </div>
            <div class="cat-item" onclick="selectCat(this, 2, 100)">
                <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png">
                <div>Ø§Ù„Ø°Ù‡Ø¨ÙŠ</div><small>5 Ø£Ø±ÙˆØ§Ø­ | 100$</small>
            </div>
            <div class="cat-item" onclick="selectCat(this, 3, 500)">
                <img src="https://cdn-icons-png.flaticon.com/512/616/616430.png">
                <div>Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ</div><small>9 Ø£Ø±ÙˆØ§Ø­ | 500$</small>
            </div>
        </div>

        <div style="background:rgba(255,215,0,0.1); padding:15px; border-radius:15px; margin-top:10px;">
            <div id="palace-info"><b>Ù‚ØµØ± Ø§Ù„ØºØ¨Ø§Ø± (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1)</b><br>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„: 10$ | Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: 50$</div>
        </div>

        <button class="btn-play" onclick="startRoyalGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚ØµØ± ğŸ¾</button>
    </div>
</div>

<script>
const canvas = document.createElement('canvas'), ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

// Ø§Ù„Ø£ØµÙˆÙ„
const imgs = { cat: new Image(), mon: new Image(), coin: new Image() };
imgs.cat.src = 'https://cdn-icons-png.flaticon.com/512/616/616408.png';
imgs.mon.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png';
imgs.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';

let config = { balance: 1000, currentCat: 1, currentLives: 3, unlockedLevels: 1 };
let game = { playing: false, score: 0, lives: 3, dist: 0, frame: 0, level: 1 };
let player = { x: 0, y: 0, v: 0, g: 0.5, j: -10, w: 85, h: 80 };
let world = { obs: [], items: [] };

function resize() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    player.x = canvas.width * 0.15;
}
window.onresize = resize; resize();

function selectCat(el, type, price) {
    if(config.balance < price) return alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ!");
    document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
    config.currentCat = type;
    config.currentLives = type === 1 ? 3 : (type === 2 ? 5 : 9);
}

function startRoyalGame() {
    let fee = 10 * game.level;
    if(config.balance < fee) return alert("Ù„Ø§ ØªÙ…Ù„Ùƒ Ø±Ø³ÙˆÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„!");
    
    config.balance -= fee;
    game.playing = true; game.score = 0; game.dist = 0; game.frame = 0;
    game.lives = config.currentLives;
    world = { obs: [], items: [] };
    player.y = canvas.height/2;

    document.getElementById('overlay').style.display = 'none';
    document.getElementById('hud').style.display = 'flex';
    updateHUD();
    loop();
}

function updateHUD() {
    document.getElementById('balance').innerText = config.balance;
    document.getElementById('lives').innerText = "â¤ï¸".repeat(game.lives);
    document.getElementById('score').innerText = game.score;
}

function loop() {
    if(!game.playing) return;
    game.frame++; game.dist += (4 + game.level);

    // Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ¦Ø© (Ø§Ù„Ù‚ØµØ± Ø§Ù„Ù…Ù„ÙƒÙŠ)
    let grd = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
    grd.addColorStop(0, '#1a0a00'); grd.addColorStop(1, '#000');
    ctx.fillStyle = grd; ctx.fillRect(0,0,canvas.width, canvas.height);

    // Ù†ÙˆØ§ÙØ° Ù…Ø¶ÙŠØ¦Ø©
    ctx.fillStyle = 'rgba(255,215,0,0.05)';
    for(let i=0; i<3; i++) {
        let x = (i * 600) - (game.dist % 600);
        ctx.fillRect(x + 200, 50, 100, 300);
    }

    // Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ù„Ù‚Ø·Ø©)
    player.v += player.g; player.y += player.v;
    ctx.save();
    ctx.shadowBlur = 20; ctx.shadowColor = varColor();
    ctx.drawImage(imgs.cat, player.x, player.y, player.w, player.h);
    ctx.restore();

    // Ø§Ù„ÙˆØ­ÙˆØ´ Ø§Ù„Ù…Ø±Ø¹Ø¨Ø© (Ø§Ù„Ø­Ø±Ø§Ø³)
    if(game.frame % Math.max(25, 60 - game.level*5) == 0) {
        world.obs.push({x: canvas.width, y: Math.random()*(canvas.height-150), s: 90, sp: 7 + game.level});
    }
    world.obs.forEach((o, i) => {
        o.x -= o.sp;
        ctx.drawImage(imgs.mon, o.x, o.y, o.s, o.s);
        if(player.x+20 < o.x+o.s-20 && player.x+player.w-20 > o.x+20 && player.y+20 < o.y+o.s-20 && player.y+player.h-20 > o.y+20) {
            game.lives--; flashEffect();
            world.obs.splice(i, 1);
            if(game.lives <= 0) endGame(false);
            updateHUD();
        }
    });

    // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    if(game.frame % 50 == 0) world.items.push({x: canvas.width, y: Math.random()*canvas.height});
    world.items.forEach((c, i) => {
        c.x -= 6;
        ctx.drawImage(imgs.coin, c.x, c.y, 40, 40);
        if(Math.hypot(player.x+40-c.x, player.y+40-c.y) < 50) {
            game.score += 10; world.items.splice(i, 1); updateHUD();
        }
    });

    if(player.y < -100 || player.y > canvas.height + 100) endGame(false);
    if(game.dist > 5000) endGame(true);

    requestAnimationFrame(loop);
}

function flashEffect() {
    const f = document.getElementById('flash');
    f.style.opacity = 0.5;
    setTimeout(() => f.style.opacity = 0, 100);
}

function varColor() { return config.currentCat === 3 ? '#a864c8' : '#FFD700'; }

function endGame(win) {
    game.playing = false;
    if(win) {
        let winPrize = 50 * game.level;
        config.balance += winPrize;
        alert(`ğŸŒŸ Ù†ØµØ± Ù…Ù„ÙƒÙŠ! Ø±Ø¨Ø­Øª ${winPrize}$`);
        game.level++;
    } else {
        alert("ğŸ’€ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø±Ø­Ù„Ø© ÙÙŠ Ø¯Ù‡Ø§Ù„ÙŠØ² Ø§Ù„Ù‚ØµØ±!");
    }
    document.getElementById('overlay').style.display = 'flex';
    document.getElementById('hud').style.display = 'none';
    updateHUD();
}

window.onmousedown = () => { if(game.playing) player.v = player.j; };
window.ontouchstart = (e) => { if(game.playing) player.v = player.j; e.preventDefault(); };
</script>
</body>
</html>