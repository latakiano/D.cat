<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: Empire of Shadows</title>
    <style>
        :root { --gold: #FFD700; --crimson: #990000; --dark: #0a0a0a; }
        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }
        body { background: var(--dark); overflow: hidden; font-family: 'Cairo', sans-serif; color: white; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª HUD */
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 100; }
        .stat { background: rgba(0,0,0,0.8); border: 1px solid var(--gold); padding: 8px 15px; border-radius: 15px; font-weight: bold; }

        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 200; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .panel { background: #1a1a1a; border: 3px solid var(--gold); border-radius: 30px; padding: 30px; width: 100%; max-width: 400px; }
        
        /* Ø§Ù„Ù…ØªØ¬Ø± */
        #shop-items { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .item { background: #333; padding: 10px; border-radius: 10px; border: 1px solid #555; cursor: pointer; }
        .item:hover { border-color: var(--gold); }

        .btn { background: var(--gold); color: #000; border: none; padding: 12px 30px; font-size: 18px; font-weight: bold; border-radius: 10px; cursor: pointer; margin-top: 15px; width: 100%; }
        
        #game-canvas { display: block; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat">ğŸ’° <span id="coin-txt">520</span></div>
    <div class="stat">ğŸ° <span id="stage-txt">1</span>/20</div>
    <div class="stat">â¤ï¸ <span id="life-txt">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="main-menu" class="screen">
    <div class="panel">
        <h1 style="color:var(--gold)">Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø¸Ù„Ø§Ù„ ğŸ¾</h1>
        <p id="stage-desc">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¯Ù‡Ø§Ù„ÙŠØ² Ø§Ù„ØºØ¨Ø§Ø± Ø§Ù„Ù…Ù„Ø¹ÙˆÙ†Ø©</p>
        
        <div id="shop-items">
            <div class="item" onclick="buy('life')">â¤ï¸ Ù‚Ù„Ø¨ Ø¥Ø¶Ø§ÙÙŠ<br><small>50 ÙƒÙˆÙŠÙ†Ø²</small></div>
            <div class="item" onclick="buy('shield')">ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø­Ù…Ø§ÙŠØ©<br><small>100 ÙƒÙˆÙŠÙ†Ø²</small></div>
        </div>
        
        <button class="btn" onclick="startGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² (10 ğŸ’°)</button>
    </div>
</div>

<canvas id="game-canvas"></canvas>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

// --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø±Ùƒ ---
let state = {
    coins: 520, stage: 1, lives: 3, shield: false,
    playing: false, distance: 0, target: 3000
};

let player = { x: 50, y: 0, v: 0, g: 0.5, j: -10, s: 60 };
let objects = { monsters: [], gold: [], clouds: [] };

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    player.x = canvas.width * 0.15;
}
window.onresize = resize; resize();

// --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ¬Ø± ---
function buy(type) {
    if(type === 'life' && state.coins >= 50) {
        state.coins -= 50; state.lives++;
    } else if(type === 'shield' && state.coins >= 100) {
        state.coins -= 100; state.shield = true;
    }
    updateUI();
}

// --- Ø±Ø³Ù… Ø§Ù„Ø¯Ù‡Ø§Ù„ÙŠØ² ÙˆØ§Ù„ÙˆØ­ÙˆØ´ ---
function drawPlayer() {
    ctx.fillStyle = state.shield ? "#00f2ff" : "#fff";
    ctx.shadowBlur = state.shield ? 20 : 0;
    ctx.beginPath(); ctx.arc(player.x + 30, player.y + 30, 30, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "#000"; ctx.fillRect(player.x + 40, player.y + 20, 5, 5); // Ø¹ÙŠÙ†
}

function drawMonster(m) {
    ctx.fillStyle = m.boss ? "red" : m.color;
    ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
    ctx.beginPath();
    for(let i=0; i<5; i++) { // Ø´ÙƒÙ„ ÙˆØ­Ø´ Ù…Ø¯Ø¨Ø¨
        let a = (i/5) * Math.PI*2 + Date.now()*0.01;
        ctx.lineTo(m.x + 30 + Math.cos(a)*m.s, m.y + 30 + Math.sin(a)*m.s);
    }
    ctx.fill();
}

// --- Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
function startGame() {
    if(state.coins < 10) return;
    state.coins -= 10;
    state.playing = true;
    state.distance = 0;
    state.target = 3000 + (state.stage * 1000);
    objects = { monsters: [], gold: [], clouds: [] };
    document.getElementById('main-menu').classList.add('hidden');
    updateUI();
    loop();
}

function loop() {
    if(!state.playing) return;

    // Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    ctx.fillStyle = "#0a0a0a"; ctx.fillRect(0,0,canvas.width, canvas.height);
    
    // ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù‚Ø·Ø©
    player.v += player.g; player.y += player.v;
    if(player.y > canvas.height - 60) player.y = canvas.height - 60;
    if(player.y < 0) player.y = 0;
    drawPlayer();

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­ÙˆØ´ (20 Ù…Ø±Ø­Ù„Ø© Ù…Ù† Ø§Ù„ØµØ¹ÙˆØ¨Ø©)
    if(Math.random() < 0.02 + (state.stage * 0.002)) {
        objects.monsters.push({
            x: canvas.width, y: Math.random()*(canvas.height-60),
            s: 40 + (state.stage*2), spd: 5 + (state.stage*0.5),
            color: `hsl(${state.stage * 20}, 70%, 50%)`
        });
    }

    objects.monsters.forEach((m, i) => {
        m.x -= m.spd;
        drawMonster(m);
        // ØªØµØ§Ø¯Ù…
        if(Math.hypot(player.x - m.x, player.y - m.y) < 50) {
            if(state.shield) { state.shield = false; }
            else { state.lives--; }
            objects.monsters.splice(i, 1);
            if(state.lives <= 0) gameOver();
            updateUI();
        }
    });

    // Ø§Ù„Ø°Ù‡Ø¨
    if(Math.random() < 0.03) objects.gold.push({x: canvas.width, y: Math.random()*canvas.height});
    objects.gold.forEach((g, i) => {
        g.x -= 6;
        ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(g.x, g.y, 10, 0, Math.PI*2); ctx.fill();
        if(Math.hypot(player.x - g.x, player.y - g.y) < 40) {
            state.coins += 10; objects.gold.splice(i, 1); updateUI();
        }
    });

    state.distance += 10;
    if(state.distance >= state.target) winStage();
    else requestAnimationFrame(loop);
}

function updateUI() {
    document.getElementById('coin-txt').innerText = state.coins;
    document.getElementById('stage-txt').innerText = state.stage;
    document.getElementById('life-txt').innerText = "â¤ï¸".repeat(state.lives);
}

function winStage() {
    state.playing = false;
    state.stage++;
    document.getElementById('main-menu').classList.remove('hidden');
    document.getElementById('stage-desc').innerText = `ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${state.stage}`;
}

function gameOver() {
    state.playing = false;
    state.stage = 1;
    document.getElementById('main-menu').classList.remove('hidden');
    document.getElementById('stage-desc').innerText = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø³Ø­Ù‚ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´.";
}

// Ø§Ù„ØªØ­ÙƒÙ…
window.onmousedown = () => { if(state.playing) player.v = player.j; };
window.ontouchstart = (e) => { e.preventDefault(); if(state.playing) player.v = player.j; };
</script>
</body>
</html>