<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: Cat Empire - Absolute Terror</title>
    <style>
        :root { --gold: #FFD700; --blood: #ff0000; --neon-blue: #00f2ff; --dark-purple: #3a0050; }
        * { box-sizing: border-box; touch-action: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Arial Black', Gadget, sans-serif; }
        
        /* HUD - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 1000; pointer-events: none; }
        .stat-badge { background: rgba(0,0,0,0.8); border: 2px solid var(--gold); color: white; padding: 8px 18px; border-radius: 30px; font-weight: bold; font-size: 1.1em; box-shadow: 0 0 15px rgba(255,215,0,0.3); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(12px); }
        .royal-panel { background: linear-gradient(145deg, #1a1a1a, #0a0a0a); border: 3px solid var(--gold); border-radius: 35px; padding: 40px; text-align: center; color: white; width: 90%; max-width: 500px; box-shadow: 0 0 60px rgba(255,215,0,0.4); }
        .royal-panel h1 { font-size: 2.8em; color: var(--gold); margin-bottom: 15px; text-shadow: 0 0 15px var(--gold); }
        .royal-panel p { color: #ccc; font-size: 1.1em; line-height: 1.6; margin-bottom: 30px; }
        .btn-start { background: var(--gold); color: black; border: none; padding: 18px 60px; font-size: 1.8em; font-weight: bold; border-radius: 50px; cursor: pointer; transition: 0.3s; box-shadow: 0 8px 25px rgba(255,215,0,0.5); }
        .btn-start:hover { transform: scale(1.05); }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨Ø±Ù‚/Ø§Ù„ÙˆÙ…ÙŠØ¶ */
        #shock-flash { position: fixed; inset: 0; background: var(--blood); opacity: 0; pointer-events: none; z-index: 1500; transition: opacity 0.1s ease-out; }
        /* Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© */
        #stage-progress { position: fixed; bottom: 0; left: 0; height: 8px; background: linear-gradient(90deg, var(--neon-blue), var(--gold)); width: 0%; transition: width 0.1s linear; }

        canvas { display: block; filter: saturate(1.2); }
    </style>
</head>
<body>

<div id="shock-flash"></div>
<div id="stage-progress"></div>

<div id="hud">
    <div class="stat-badge">ğŸ’° <span id="coins-display">500</span></div>
    <div class="stat-badge">ğŸ‘‘ <span id="stage-display">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1</span></div>
    <div class="stat-badge">â¤ï¸ <span id="lives-display">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="overlay">
    <div class="royal-panel">
        <h1 id="menu-title">Ø¹Ø±Ø´ Ø§Ù„Ø¸Ù„Ø§Ù„: Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù‚Ø·Ø·</h1>
        <p id="menu-description">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="current-stage-info">1</span>. Ø§Ø¯ÙØ¹ <span id="entry-fee">10</span> ÙƒÙˆÙŠÙ†Ø² Ù„ØªÙˆØ§Ø¬Ù‡ ÙˆØ­ÙˆØ´ Ø§Ù„Ø¸Ù„ ÙˆØªÙƒØªØ´Ù ÙƒÙ†ÙˆØ² Ø§Ù„Ø£Ø³Ø±Ø§Ø±!</p>
        <button class="btn-start" onclick="initGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚ØµØ± Ø§Ù„Ù…Ù„Ø¹ÙˆÙ† ğŸ¾</button>
    </div>
</div>

<script>
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

// --- Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„ØµÙˆØ±) ---
const assets = {
    cat: new Image(), coin: new Image(), shield: new Image(),
    monsterTypes: [new Image(), new Image(), new Image(), new Image(), new Image()]
};
assets.cat.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png';
assets.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';
assets.shield.src = 'https://cdn-icons-png.flaticon.com/512/2807/2807494.png';
assets.monsterTypes[0].src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png'; // ØºÙˆÙ„ Ø§Ù„Ø¸Ù„ (Ù…Ø±Ø§Ø­Ù„ 1-4)
assets.monsterTypes[1].src = 'https://cdn-icons-png.flaticon.com/512/606/606795.png';  // Ø®ÙØ§Ø´ Ø§Ù„Ø¯Ù…Ø§Ø¡ (Ù…Ø±Ø§Ø­Ù„ 5-9)
assets.monsterTypes[2].src = 'https://cdn-icons-png.flaticon.com/512/1068/1068132.png'; // Ø´Ø¨Ø­ Ø§Ù„ØµØ¯Ù‰ (Ù…Ø±Ø§Ø­Ù„ 10-14)
assets.monsterTypes[3].src = 'https://cdn-icons-png.flaticon.com/512/865/865761.png';  // ÙˆØ­Ø´ Ø§Ù„Ø´Ø¨Ø­ Ø§Ù„Ø¶Ø®Ù… (Ù…Ø±Ø§Ø­Ù„ 15-19)
assets.monsterTypes[4].src = 'https://cdn-icons-png.flaticon.com/512/4334/4334000.png'; // ØªÙ†ÙŠÙ† Ø§Ù„Ø¸Ù„Ø§Ù„ (Boss - Ø§Ù„Ù…Ø±Ø­Ù„Ø© 20)

// --- Ù…Ø­Ø±Ùƒ Ø§Ù„ØµÙˆØª (Ù…Ø§Ø±ÙŠÙˆ + Ø±Ø¹Ø¨) ---
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
function playSFX(type) {
    if (audioContext.state === 'suspended') audioContext.resume();
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    osc.connect(gain); gain.connect(audioContext.destination);

    if (type === 'jump') { // Mario Jump
        osc.frequency.setValueAtTime(150, audioContext.currentTime);
        osc.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.1);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.1);
        osc.start(); osc.stop(audioContext.currentTime + 0.1);
    } else if (type === 'coin') { // Mario Coin
        osc.frequency.setValueAtTime(987, audioContext.currentTime);
        osc.frequency.setValueAtTime(1318, audioContext.currentTime + 0.08);
        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.3);
        osc.start(); osc.stop(audioContext.currentTime + 0.3);
    } else if (type === 'hit') { // Horror Hit
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(120, audioContext.currentTime);
        osc.frequency.linearRampToValueAtTime(30, audioContext.currentTime + 0.2);
        gain.gain.setValueAtTime(0.3, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.2);
        osc.start(); osc.stop(audioContext.currentTime + 0.2);
    } else if (type === 'boss_hit') { // Boss Hit Sound
        osc.type = 'square';
        osc.frequency.setValueAtTime(80, audioContext.currentTime);
        osc.frequency.linearRampToValueAtTime(20, audioContext.currentTime + 0.4);
        gain.gain.setValueAtTime(0.5, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.4);
        osc.start(); osc.stop(audioContext.currentTime + 0.4);
    } else if (type === 'rage_on') { // Rage Mode Activation
        osc.type = 'sine';
        osc.frequency.setValueAtTime(440, audioContext.currentTime);
        osc.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1);
        gain.gain.setValueAtTime(0.2, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.1);
        osc.start(); osc.stop(audioContext.currentTime + 0.1);
    }
}

// --- Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
let game = {
    playing: false,
    stage: 1,
    coins: 500,
    lives: 3,
    distance: 0,
    targetDistance: 5000,
    catRage: 0, // ÙˆØ¶Ø¹ Ø§Ù„ØºØ¶Ø¨
    shieldActive: false,
    comboCount: 0, // Ø¹Ø¯Ø§Ø¯ Ù„Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØºØ¶Ø¨
    bossHealth: 0, // ØµØ­Ø© Ø§Ù„Ø¨ÙˆØ³
    levelNames: ["Ø³Ø±Ø¯Ø§Ø¨ Ø§Ù„ØºØ¨Ø§Ø±", "ØºØ§Ø¨Ø© Ø§Ù„Ø£Ø±ÙˆØ§Ø­", "ÙƒÙ‡ÙˆÙ Ø§Ù„ØµØ¯Ù‰", "Ø¹Ø§Ù„Ù… Ø§Ù„Ø¸Ù„Ø§Ù„", "Ø¹Ø±Ø´ Ø§Ù„ØªÙ†ÙŠÙ†"]
};
let player = { x: 0, y: 0, velocity: 0, gravity: 0.5, jumpPower: -10, width: 85, height: 85 };
let entities = { monsters: [], items: [], shadows: [] }; // Ø§Ù„Ø¸Ù„Ø§Ù„ Ù„Ù„ÙˆØ­ÙˆØ´

function resizeGame() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    player.x = canvas.width * 0.15;
    player.y = canvas.height / 2;
}
window.onresize = resizeGame;
resizeGame();

// --- ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø±Ø³ÙˆÙ…Ø§Øª ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª ---
function flashScreen() {
    document.getElementById('shock-flash').style.opacity = 1;
    setTimeout(() => document.getElementById('shock-flash').style.opacity = 0, 100);
}

function updateHUD() {
    document.getElementById('coins-display').innerText = game.coins;
    document.getElementById('stage-display').innerText = game.levelNames[Math.min(game.levelNames.length - 1, Math.floor((game.stage - 1) / 4))];
    document.getElementById('lives-display').innerText = "â¤ï¸".repeat(game.lives);
    document.getElementById('stage-progress').style.width = (game.distance / game.targetDistance * 100) + "%";
}

// --- Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© / Ø§Ù„Ù…Ø±Ø­Ù„Ø© ---
function initGame() {
    const entryFee = 10;
    if (game.coins < entryFee) {
        alert("Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ø§Ù„ÙƒØ§ÙÙŠØ© Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©!");
        return;
    }
    game.coins -= entryFee;
    game.playing = true;
    game.distance = 0;
    game.lives = 3;
    game.catRage = 0;
    game.shieldActive = false;
    game.comboCount = 0;
    game.targetDistance = 3000 + (game.stage * 1000); // ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ø£Ø·ÙˆÙ„
    game.bossHealth = game.stage === 20 ? 3 : 0; // Ø§Ù„Ø¨ÙˆØ³ ÙŠØ­ØªØ§Ø¬ 3 Ø¶Ø±Ø¨Ø§Øª
    entities = { monsters: [], items: [], shadows: [] };
    player.y = canvas.height / 2;

    document.getElementById('overlay').style.display = 'none';
    updateHUD();
    gameLoop();
}

// --- Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
function gameLoop() {
    if (!game.playing) return;

    // ØªØ­Ø¯ÙŠØ« ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨
    player.velocity += player.gravity;
    player.y += player.velocity;
    if (player.y > canvas.height - player.height) player.y = canvas.height - player.height;
    if (player.y < 0) player.y = 0;

    game.distance += (5 + game.stage * 0.5); // Ø³Ø±Ø¹Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©

    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…
    const worldIndex = Math.min(game.levelNames.length - 1, Math.floor((game.stage - 1) / 4));
    const baseHue = worldIndex * 60;
    ctx.fillStyle = `hsl(${baseHue}, 15%, 8%)`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¶ÙˆØ¦ÙŠØ© Ø®ÙÙŠÙØ© Ù„Ù„Ø®Ù„ÙÙŠØ©
    ctx.fillStyle = `rgba(255,255,255,0.02)`;
    for (let i = 0; i < 5; i++) {
        const xOffset = (i * 400 - (game.distance % 400));
        ctx.fillRect(xOffset + 50, 0, 100, canvas.height);
    }

    // --- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙˆØ­ÙˆØ´ ---
    let monsterSpawnRate = game.stage === 20 ? 0.008 : (0.015 + (game.stage * 0.002));
    if (Math.random() < monsterSpawnRate) {
        let monsterSize = game.stage === 20 ? 250 : (80 + (game.stage * 2));
        let monsterTypeIndex = worldIndex;
        if (game.stage === 20) monsterTypeIndex = 4; // Boss type
        entities.monsters.push({
            x: canvas.width,
            y: Math.random() * (canvas.height - monsterSize),
            width: monsterSize,
            height: monsterSize,
            speed: 6 + (game.stage * 0.8),
            type: monsterTypeIndex
        });
    }

    // --- ØªØ­Ø¯ÙŠØ« ÙˆØ±Ø³Ù… Ø§Ù„ÙˆØ­ÙˆØ´ ---
    for (let i = entities.monsters.length - 1; i >= 0; i--) {
        const monster = entities.monsters[i];
        monster.x -= monster.speed;

        // Ø°ÙƒØ§Ø¡ Ø§Ù„ÙˆØ­ÙˆØ´ (ØªÙ„Ø§Ø­Ù‚ Ø§Ù„Ù‚Ø·Ø©)
        if (game.stage > 8 && monster.x < canvas.width * 0.7) {
            if (player.y < monster.y) monster.y -= 1.5;
            else monster.y += 1.5;
        }

        // Ø±Ø³Ù… Ø§Ù„ÙˆØ­Ø´ ÙˆØ¸Ù„Ù‡ Ø§Ù„Ù…ØªØ­Ø±Ùƒ
        ctx.save();
        ctx.shadowBlur = 20;
        ctx.shadowColor = monster.type === 4 ? varColor('--blood') : 'rgba(0,0,0,0.8)';
        ctx.drawImage(assets.monsterTypes[monster.type], monster.x, monster.y, monster.width, monster.height);
        ctx.restore();

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¸Ù„Ø§Ù„ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„ÙˆØ­ÙˆØ´ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©
        if (game.stage >= 10 && Math.random() < 0.3) {
            entities.shadows.push({
                x: monster.x + (Math.random() - 0.5) * 20,
                y: monster.y + monster.height * 0.8,
                size: monster.width * 0.7,
                alpha: 0.5,
                life: 30
            });
        }

        // ØªØµØ§Ø¯Ù…
        if (checkCollision(player, monster)) {
            if (game.catRage > 0) { // ÙˆØ¶Ø¹ Ø§Ù„ØºØ¶Ø¨ ÙŠÙ‚ØªÙ„ Ø§Ù„ÙˆØ­ÙˆØ´
                entities.monsters.splice(i, 1);
                game.coins += 20;
                playSFX('coin');
            } else if (game.shieldActive) { // Ø§Ù„Ø¯Ø±Ø¹ ÙŠØ­Ù…ÙŠ Ø¶Ø±Ø¨Ø© ÙˆØ§Ø­Ø¯Ø©
                game.shieldActive = false;
                entities.monsters.splice(i, 1);
                flashScreen();
                playSFX('hit');
            } else {
                game.lives--;
                entities.monsters.splice(i, 1);
                flashScreen();
                playSFX('hit');
                if (game.lives <= 0) finishGame(false);
            }
        }
        if (monster.x + monster.width < 0) entities.monsters.splice(i, 1); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ­ÙˆØ´ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø©
    }
    
    // --- ØªØ­Ø¯ÙŠØ« ÙˆØ±Ø³Ù… Ø§Ù„Ø¸Ù„Ø§Ù„ ---
    for (let i = entities.shadows.length - 1; i >= 0; i--) {
        const shadow = entities.shadows[i];
        shadow.life--;
        shadow.x -= 3; // Ø§Ù„Ø¸Ù„Ø§Ù„ ØªÙ†Ø¬Ø±Ù Ù‚Ù„ÙŠÙ„Ø§
        shadow.alpha = shadow.life / 30; // ØªØªÙ„Ø§Ø´Ù‰
        ctx.globalAlpha = shadow.alpha;
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.beginPath();
        ctx.ellipse(shadow.x, shadow.y, shadow.size / 2, shadow.size / 4, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
        if (shadow.life <= 0) entities.shadows.splice(i, 1);
    }

    // --- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± (ÙƒÙˆÙŠÙ†Ø² ÙˆØ¯Ø±ÙˆØ¹) ---
    if (Math.random() < 0.03) { // ÙƒÙˆÙŠÙ†Ø²
        entities.items.push({ x: canvas.width, y: Math.random() * (canvas.height - 50), width: 45, height: 45, type: 'coin' });
    }
    if (Math.random() < 0.005 && !game.shieldActive) { // Ø¯Ø±Ø¹ Ù†Ø§Ø¯Ø±
        entities.items.push({ x: canvas.width, y: Math.random() * (canvas.height - 50), width: 45, height: 45, type: 'shield' });
    }

    // --- ØªØ­Ø¯ÙŠØ« ÙˆØ±Ø³Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± ---
    for (let i = entities.items.length - 1; i >= 0; i--) {
        const item = entities.items[i];
        item.x -= 5;
        ctx.drawImage(item.type === 'coin' ? assets.coin : assets.shield, item.x, item.y, item.width, item.height);

        if (checkCollision(player, item)) {
            if (item.type === 'coin') {
                game.coins += 10;
                game.comboCount++;
                if (game.comboCount >= 5) { // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØºØ¶Ø¨
                    game.catRage = 200; // 200 ÙØ±ÙŠÙ… = Ø­ÙˆØ§Ù„ÙŠ 3 Ø«ÙˆØ§Ù†ÙŠ
                    game.comboCount = 0;
                    playSFX('rage_on');
                }
                playSFX('coin');
            } else if (item.type === 'shield') {
                game.shieldActive = true;
                playSFX('coin'); // ØµÙˆØª Ø¬Ù…Ø¹ Ù…Ù…ÙŠØ²
            }
            entities.items.splice(i, 1);
        }
        if (item.x + item.width < 0) entities.items.splice(i, 1);
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ¶Ø¹ Ø§Ù„ØºØ¶Ø¨
    if (game.catRage > 0) game.catRage--;

    // ÙØ­Øµ Ø§Ù„ÙÙˆØ² Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    if (game.distance >= game.targetDistance) finishGame(true);
    else requestAnimationFrame(gameLoop);

    updateHUD();
}

// --- ÙØ­Øµ Ø§Ù„ØªØµØ§Ø¯Ù… ---
function checkCollision(obj1, obj2) {
    return obj1.x < obj2.x + obj2.width &&
           obj1.x + obj1.width > obj2.x &&
           obj1.y < obj2.y + obj2.height &&
           obj1.y + obj1.height > obj2.y;
}

// --- Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© / Ø§Ù„Ù…Ø±Ø­Ù„Ø© ---
function finishGame(win) {
    game.playing = false;
    document.getElementById('overlay').style.display = 'flex';
    const title = document.getElementById('menu-title');
    const description = document.getElementById('menu-description');
    const currentStageInfo = document.getElementById('current-stage-info');
    const entryFeeDisplay = document.getElementById('entry-fee');
    const rewardBox = document.getElementById('reward-box');

    if (win) {
        if (game.stage === 20) {
            title.innerText = "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£Ù†Øª Ù…Ù„Ùƒ Ø§Ù„Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§! ğŸ‘‘";
            description.innerText = "Ù„Ù‚Ø¯ Ù‡Ø²Ù…Øª Ø¹Ø±Ø´ Ø§Ù„Ø¸Ù„Ø§Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ£ØµØ¨Ø­Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ø®Ø§Ù„Ø¯Ø©!";
            rewardBox.style.display = 'block'; rewardBox.innerText = "ğŸ Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„: +500 ÙƒÙˆÙŠÙ†Ø²!";
            game.coins += 500;
            game.stage = 1; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ÙÙˆØ² Ø§Ù„ÙƒØ¨ÙŠØ±
        } else {
            title.innerText = `Ø§Ù„Ù†ØµØ±! Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${game.stage} Ø§ÙƒØªÙ…Ù„Øª! ğŸ‰`;
            description.innerText = "Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©. Ø§Ù„ÙˆØ­ÙˆØ´ Ø£ØµØ¨Ø­Øª Ø£Ù‚ÙˆÙ‰!";
            if (game.stage % 4 === 0) { // Ø¬Ø§Ø¦Ø²Ø© ÙƒÙ„ 4 Ù…Ø±Ø§Ø­Ù„
                rewardBox.style.display = 'block'; rewardBox.innerText = `ğŸ Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„Ø¹Ø§Ù„Ù…: +${50 * game.stage} ÙƒÙˆÙŠÙ†Ø²!`;
                game.coins += (50 * game.stage);
            } else { rewardBox.style.display = 'none'; }
            game.stage++;
        }
    } else {
        title.innerText = "Ù„Ù‚Ø¯ Ù‚ØªÙ„ØªÙƒ Ø§Ù„ÙˆØ­ÙˆØ´! ğŸ’€";
        description.innerText = "Ø®Ø³Ø±Øª Ø±Ù‡Ø§Ù†Ùƒ. Ù‡Ù„ ØªØ¬Ø±Ø¤ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹ØŸ";
        rewardBox.style.display = 'none';
    }

    currentStageInfo.innerText = game.stage;
    entryFeeDisplay.innerText = 10; // Ø±Ø³ÙˆÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø«Ø§Ø¨ØªØ©
    updateHUD();
}

// --- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù‚ÙØ² ---
function handleJump() {
    if (game.playing) {
        player.velocity = player.jumpPower;
        playSFX('jump');
    }
}
window.onmousedown = handleJump;
window.ontouchstart = (e) => { e.preventDefault(); handleJump(); };
</script>
</body>
</html>