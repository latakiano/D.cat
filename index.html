<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalaya: Grand Empires</title>
    <style>
        :root { --gold: #FFD700; --blood: #660000; --shadow: #0a0a0a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }

        /* Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚ØµØ± ÙˆØ§Ù„Ø±Ù‡Ø§Ù† */
        #map-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; display: flex; align-items: center; justify-content: center; overflow-y: auto; padding: 20px; }
        .map-container { width: 100%; max-width: 600px; text-align: center; }
        
        .palace-card { background: linear-gradient(145deg, #1a1a1a, #050505); border: 2px solid #333; border-radius: 20px; padding: 20px; margin-bottom: 20px; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
        .palace-card.unlocked { border-color: var(--gold); }
        .palace-card.locked { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }
        .palace-card:active { transform: scale(0.98); }
        
        .palace-title { font-size: 24px; color: var(--gold); margin: 0; }
        .palace-bet { font-size: 14px; color: #aaa; margin: 5px 0; }
        .palace-reward { font-size: 18px; color: #00ff00; font-weight: bold; }

        #hud { position: fixed; top: 0; width: 100%; padding: 15px; z-index: 1000; display: flex; justify-content: space-between; align-items: center; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 20px; border: 1px solid var(--gold); color: #fff; font-weight: bold; }

        canvas { display: block; }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø±Ø¹Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±Ø± */
        #damage-tint { position: fixed; inset: 0; background: radial-gradient(circle, transparent 50%, var(--blood) 150%); pointer-events: none; opacity: 0; transition: 0.2s; z-index: 2000; }
    </style>
</head>
<body>

<div id="damage-tint"></div>

<div id="hud">
    <div class="stat-box">ğŸ’° <span id="coins-display">500</span> ÙƒÙˆÙŠÙ†Ø²</div>
    <div class="stat-box">ğŸ“ <span id="level-name">Ù‚ØµØ± Ø§Ù„ØºØ¨Ø§Ø±</span></div>
    <div class="stat-box" style="border-color:red">â¤ï¸ <span id="lives-display">â¤ï¸â¤ï¸â¤ï¸</span></div>
</div>

<div id="map-overlay">
    <div class="map-container">
        <h1 style="color:var(--gold); text-shadow: 0 0 10px var(--gold);">Ø§Ø®ØªØ± Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h1>
        <p style="color:#888;">Ø§Ù„Ø®Ø³Ø§Ø±Ø© ØªØ¹Ù†ÙŠ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø±Ù‡Ø§Ù†.. Ø§Ù„ÙÙˆØ² ÙŠØ¹Ù†ÙŠ Ø§Ù„Ù…Ø¬Ø¯!</p>
        
        <div class="palace-card unlocked" onclick="startLevel(1, 'Ù‚ØµØ± Ø§Ù„ØºØ¨Ø§Ø±', 10, 50)">
            <div class="palace-title">ğŸ° Ù‚ØµØ± Ø§Ù„ØºØ¨Ø§Ø± (Ø³Ù‡Ù„)</div>
            <div class="palace-bet">Ø§Ù„Ø±Ù‡Ø§Ù†: 10 ÙƒÙˆÙŠÙ†Ø²</div>
            <div class="palace-reward">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: 50 ÙƒÙˆÙŠÙ†Ø²</div>
        </div>

        <div class="palace-card unlocked" onclick="startLevel(2, 'Ø³Ø±Ø§Ø¯ÙŠØ¨ Ø§Ù„Ø¯Ù…', 50, 250)">
            <div class="palace-title" style="color:#ff3131;">ğŸ©¸ Ø³Ø±Ø§Ø¯ÙŠØ¨ Ø§Ù„Ø¯Ù… (Ù…ØªÙˆØ³Ø·)</div>
            <div class="palace-bet">Ø§Ù„Ø±Ù‡Ø§Ù†: 50 ÙƒÙˆÙŠÙ†Ø²</div>
            <div class="palace-reward">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: 250 ÙƒÙˆÙŠÙ†Ø²</div>
        </div>

        <div class="palace-card locked" id="palace-3">
            <div class="palace-title" style="color:#a864c8;">ğŸ’€ Ø¹Ø±Ø´ Ø§Ù„Ø´ÙŠØ·Ø§Ù† (ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹)</div>
            <div class="palace-bet">Ø§Ù„Ø±Ù‡Ø§Ù†: 200 ÙƒÙˆÙŠÙ†Ø²</div>
            <div class="palace-reward">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: 1200 ÙƒÙˆÙŠÙ†Ø²</div>
            <div style="font-size:10px;">ÙŠÙØªØ­ Ø¨Ø¹Ø¯ 10 Ø§Ù†ØªØµØ§Ø±Ø§Øª</div>
        </div>

        <div style="margin-top:20px; color:#555;">Ù„Ø¯ÙŠÙƒ Ù‚Ø·Ø© "Ø§Ù„Ø¸Ù„ Ø§Ù„Ø£Ø³ÙˆØ¯" Ù…Ø¬Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
    </div>
</div>

<script>
const cvs = document.createElement('canvas');
const ctx = cvs.getContext('2d');
document.body.appendChild(cvs);

const imgs = {
    cat: new Image(), mon: new Image(), coin: new Image()
};
imgs.cat.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png';
imgs.mon.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png';
imgs.coin.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png';

let game = { 
    playing: false, 
    coins: 500, 
    lives: 3, 
    dist: 0, 
    target: 5000, 
    difficulty: 1, 
    frame: 0,
    currentBet: 0,
    currentPrize: 0
};

let player = { x: 0, y: 0, v: 0, g: 0.5, j: -10, w: 75, h: 70 };
let ents = { obs: [], items: [] };

function resize() {
    cvs.width = window.innerWidth; cvs.height = window.innerHeight;
    player.x = cvs.width * 0.15;
}
window.onresize = resize; resize();

function startLevel(diff, name, bet, prize) {
    if(game.coins < bet) return alert("Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‡Ø§Ù†!");
    
    game.coins -= bet;
    game.currentBet = bet;
    game.currentPrize = prize;
    game.difficulty = diff;
    game.playing = true;
    game.dist = 0;
    game.lives = 3;
    game.frame = 0;
    ents = { obs: [], items: [] };
    player.y = cvs.height/2;

    document.getElementById('coins-display').innerText = game.coins;
    document.getElementById('level-name').innerText = name;
    document.getElementById('map-overlay').style.display = 'none';
    
    requestAnimationFrame(update);
}

function update() {
    if(!game.playing) return;
    game.frame++;
    game.dist += (3 + game.difficulty);

    // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‚ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    ctx.fillStyle = game.difficulty === 1 ? '#0a0a0a' : (game.difficulty === 2 ? '#1a0000' : '#000');
    ctx.fillRect(0, 0, cvs.width, cvs.height);

    // Ø±Ø³Ù… Ø¯ÙŠÙƒÙˆØ± Ø§Ù„Ù‚ØµØ± (Ù†ÙˆØ§ÙØ° Ù…Ø±Ø¹Ø¨Ø©)
    ctx.fillStyle = 'rgba(255,255,255,0.03)';
    for(let i=0; i<4; i++) {
        let x = (i * 500) - (game.dist % 500);
        ctx.fillRect(x + 100, 100, 150, 300);
    }

    // Ø§Ù„Ù‚Ø·Ø©
    player.v += player.g; player.y += player.v;
    ctx.drawImage(imgs.cat, player.x, player.y, player.w, player.h);

    // Ø§Ù„ÙˆØ­ÙˆØ´ (ØªØ²Ø¯Ø§Ø¯ ØµØ¹ÙˆØ¨ØªÙ‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù‚ØµØ±)
    if(game.frame % Math.max(30, 80 - game.difficulty*20) === 0) {
        ents.obs.push({
            x: cvs.width, 
            y: Math.random()*(cvs.height-100), 
            s: 80 + (game.difficulty * 20),
            sp: 6 + game.difficulty*2
        });
    }

    ents.obs.forEach((o, i) => {
        o.x -= o.sp;
        ctx.drawImage(imgs.mon, o.x, o.y, o.s, o.s);
        
        // ØªØµØ§Ø¯Ù…
        if(player.x+15 < o.x+o.s-15 && player.x+player.w-15 > o.x+15 && player.y+15 < o.y+o.s-15 && player.y+player.h-15 > o.y+15) {
            triggerDamage();
            game.lives--;
            ents.obs.splice(i, 1);
            if(game.lives <= 0) endGame(false);
        }
    });

    // Ø³Ù‚Ù ÙˆØ£Ø±Ø¶ÙŠØ©
    if(player.y < -50 || player.y > cvs.height) endGame(false);

    // ÙÙˆØ²
    if(game.dist > game.target) endGame(true);

    document.getElementById('lives-display').innerText = "â¤ï¸".repeat(game.lives);
    requestAnimationFrame(update);
}

function triggerDamage() {
    const tint = document.getElementById('damage-tint');
    tint.style.opacity = 1;
    setTimeout(() => tint.style.opacity = 0, 200);
}

function endGame(win) {
    game.playing = false;
    if(win) {
        game.coins += game.currentPrize;
        alert(`ğŸ† Ø§Ù†ØªØµØ§Ø± Ø³Ø§Ø­Ù‚! Ø±Ø¨Ø­Øª ${game.currentPrize} ÙƒÙˆÙŠÙ†Ø².`);
    } else {
        alert(`ğŸ’€ Ø³Ù‚Ø·Øª ÙÙŠ Ø§Ù„Ù‚ØµØ±! Ø®Ø³Ø± Ø±Ù‡Ø§Ù†Ùƒ (${game.currentBet} ÙƒÙˆÙŠÙ†Ø²).`);
    }
    document.getElementById('coins-display').innerText = game.coins;
    document.getElementById('map-overlay').style.display = 'flex';
}

window.onmousedown = () => { if(game.playing) player.v = player.j; };
window.ontouchstart = (e) => { if(game.playing) player.v = player.j; e.preventDefault(); };
</script>
</body>
</html>